{% extends "./blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% ifequal post.editor_choice.name 'MarkDown' %}
    {% block css %}
        <link href="/static/editor.md/css/editormd.preview.min.css" rel="stylesheet" type="text/css"/>
    {% endblock %}
{% endifequal %}

{% block js %}
    {% ifequal post.editor_choice.name 'MarkDown' %}
        <script src="/static/editor.md/editormd.min.js" type="text/javascript"></script>
        <script src="/static/editor.md/lib/marked.min.js" type="text/javascript"></script>
        <script src="/static/editor.md/lib/prettify.min.js" type="text/javascript"></script>
        <script src="/static/editor.md/lib/raphael.min.js" type="text/javascript"></script>
        <script src="/static/editor.md/lib/underscore.min.js" type="text/javascript"></script>
        <script src="/static/editor.md/lib/sequence-diagram.min.js" type="text/javascript"></script>
        <script src="/static/editor.md/lib/flowchart.min.js" type="text/javascript"></script>
        <script src="/static/editor.md/lib/jquery.flowchart.min.js" type="text/javascript"></script>

    {% endifequal %}
    <script type="text/javascript">
        $(function () {

            $('#blog-comment-form').submit(function () {
                $.ajax({
                    type: "post",
                    url: "/comment/{{ post.id }}",
                    data: {
                        "comment": $("#comment").val()
                    },
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken'));
                    },
                    success: function (data, textStatus) {
                        $("#comment").val("");
                        $(".blog-comment ul").prepend(data);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.responseText);
                    }

                });
                return false;
            });

            {% ifequal post.editor_choice.name 'MarkDown' %}
                var markDownEditor = editormd.markdownToHTML("article_content_view", {
                    htmlDecode: "style, script, iframe",
                    emoji: true,
                    taskList: true,
                    tex: true,
                    flowChart: true,
                    sequenceDiagram: true,
                });
            {% endifequal %}

        })
    </script>
{% endblock %}

{% block main %}

    <div class="row">
        <div id="container-blog" class="col-md-8 col-lg-9">
            <!-- 左栏内容 -->
            <div class="well" id="post">
                <div>
                    <h3>{{ post.title }}</h3>
                </div>
                <div>
                    {% for tag in post.get_tags %}
                        <a href="/tags/{{ tag.name }}">
                            <span class="label label-blog-{{ forloop.counter }} btn">{{ tag.name }}</span>
                        </a>
                    {% endfor %}
                </div>
                <div class="post-info">
                <span>
                    <span class="glyphicon glyphicon-calendar"></span>
                    {{ post.publish_time|date:"Y-m-d" }}
                </span>
                <span>
                    <span class="glyphicon glyphicon-comment"></span>
                    {{ post.comment_set.all | length }}
                </span>
                <span>
                    <span class="glyphicon glyphicon-eye-open"></span>
                    {{ post.view_count }}
                </span>
                </div>
                <hr>
                <div class="wrap" id="article_content_view" style="background-color: transparent">
                    {% ifequal post.editor_choice.name 'tinyMCE' %}
                        {% autoescape off %}
                            {{ post.content }}
                        {% endautoescape %}
                    {% endifequal %}

                    {% ifequal post.editor_choice.name 'MarkDown' %}
                        <textarea name="content" style="display:none;">
{{ post.content }}
                         </textarea>
                    {% endifequal %}
                </div>
            </div>

            <div class="well blog-comment">
                <div class="blog-comment-edit clearfix">
                    <form id="blog-comment-form" method="post" role="form">
                        {% csrf_token %}
                        <textarea maxlength="200" id="comment" name="comment" class="form-control" rows="4"
                                  placeholder="请输入评论 限200字!"></textarea>
                        <button type="submit" class="btn btn-blog pull-right">提交</button>
                    </form>
                </div>
                <ul>
                    {% for comment in comment_list %}
                        <li>
                            <div class="blog-comment-content">
                                <div class="avatar_top">
                                    <div class="avatar"><img src="{{ user.avatar_path }}"></div>
                                    <h4 style="color: #428bca;margin-bottom: 0px">{{ comment.author.name }}</h4>

                                    <p style="font-size: 10px;margin-top: 2px">{{ comment.publish_Time | date:"Y年m月d日 H:i" }}</p>
                                </div>
                                <p style="color: #232323;font-size: 14px">{{ comment.content }}</p>

                                <div class="comment-footer clearfix text-right">
                                    <a class="reply" data-id="{{ comment.author.id }}"
                                       data-nickname="{{ user.author.name }}"
                                       href="javascript:void(0)">回复</a>
                                </div>
                                <div class="child-comment-list ">
                                    <div class="child-comment" data-id="1526183">
                                        <p>
                                            <a class="blue-link" href="#">颜兴林</a>：
                                            <a href="#" class="maleskine-author" target="_blank"
                                               data-user-slug="afb3aff4b2cb" data-original-title="" title="">@希拉李</a>
                                            如今的环境和食品都很不安全，会产生很多隐疾，一开始无病无痛，真正被发现时就晚了。作为子女，还是要多多关心父母的身体，有细微的不良反应都要引起重视，不要像我一样，空留余恨。祝您父母安康。
                                        </p>

                                        <div class="child-comment-footer text-right clearfix">
                                            <a data-id="1524513" data-nickname="颜兴林" class="reply"
                                               href="javascript:void(0)">回复</a>
                                            <span class="reply-time pull-left">
                                                2016年02月24日 09:07
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="marginTop10 col-md-4 col-lg-3 hidden-xs">
            {% include "./blog/include/year_write_posts.html" %}
            {% include "./blog/include/hot_posts.html" %}
            {% include "./blog/include/friendly_link.html" %}
        </div>
    </div>

{% endblock %}